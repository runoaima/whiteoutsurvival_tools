const rankGroups = document.getElementById("rankGroups");
const resultDiv = document.getElementById("result");

const materialKeys = ["火晶", "製錬火晶", "生肉", "木材", "石炭", "鉄鉱", "所要時間"];

const imageDataEl = document.getElementById("fire_crystal_image_data");
const fire_crystal_materialImages = {
    "火晶": imageDataEl.dataset.fireCrystalUrl,
    "製錬火晶": imageDataEl.dataset.refinedFireCrystalUrl,
    "生肉": imageDataEl.dataset.meatUrl,
    "木材": imageDataEl.dataset.woodUrl,
    "石炭": imageDataEl.dataset.coalUrl,
    "鉄鉱": imageDataEl.dataset.ironUrl,
    "所要時間": imageDataEl.dataset.speedupsUrl
};

const setNames = ["大溶鉱炉", "大使館", "盾兵舎", "槍兵舎", "弓兵舎", "司令部", "軍医所", "戦争学園"];

const fireLevels = [
    "なし", "30-1", "30-2", "30-3", "30-4", "FC1",
    "FC1-1", "FC1-2", "FC1-3", "FC1-4", "FC2",
    "FC2-1", "FC2-2", "FC2-3", "FC2-4", "FC3",
    "FC3-1", "FC3-2", "FC3-3", "FC3-4", "FC4",
    "FC4-1", "FC4-2", "FC4-3", "FC4-4", "FC5",
    "FC5-1", "FC5-2", "FC5-3", "FC5-4", "FC6",
    "FC6-1", "FC6-2", "FC6-3", "FC6-4", "FC7",
    "FC7-1", "FC7-2", "FC7-3", "FC7-4", "FC8"
];


// 大溶鉱炉の素材一覧
const blastMaterial = {
    0: ["火晶×132", "製錬火晶×0", "生肉×67", "木材×67", "石炭×13", "鉄鉱×3.3", "所要時間×10080"], // 30 - 1
    1: ["火晶×132", "製錬火晶×0", "生肉×67", "木材×67", "石炭×13", "鉄鉱×3.3", "所要時間×10080"], // 30 - 2
    2: ["火晶×132", "製錬火晶×0", "生肉×67", "木材×67", "石炭×13", "鉄鉱×3.3", "所要時間×10080"], // 30 - 3
    3: ["火晶×132", "製錬火晶×0", "生肉×67", "木材×67", "石炭×13", "鉄鉱×3.3", "所要時間×10080"], // 30 - 4
    4: ["火晶×132", "製錬火晶×0", "生肉×67", "木材×67", "石炭×13", "鉄鉱×3.3", "所要時間×10080"], // FC1
    5: ["火晶×158", "製錬火晶×0", "生肉×72", "木材×72", "石炭×14", "鉄鉱×3.6", "所要時間×12960"], // FC1-1
    6: ["火晶×158", "製錬火晶×0", "生肉×72", "木材×72", "石炭×14", "鉄鉱×3.6", "所要時間×12960"], // FC1-2
    7: ["火晶×158", "製錬火晶×0", "生肉×72", "木材×72", "石炭×14", "鉄鉱×3.6", "所要時間×12960"], // FC1-3
    8: ["火晶×158", "製錬火晶×0", "生肉×72", "木材×72", "石炭×14", "鉄鉱×3.6", "所要時間×12960"], // FC1-4
    9: ["火晶×158", "製錬火晶×0", "生肉×72", "木材×72", "石炭×14", "鉄鉱×3.6", "所要時間×12960"], // FC2
    10: ["火晶×238", "製錬火晶×0", "生肉×79", "木材×79", "石炭×15", "鉄鉱×3.9", "所要時間×15840"], // FC2-1
    11: ["火晶×238", "製錬火晶×0", "生肉×79", "木材×79", "石炭×15", "鉄鉱×3.9", "所要時間×15840"], // FC2-2
    12: ["火晶×238", "製錬火晶×0", "生肉×79", "木材×79", "石炭×15", "鉄鉱×3.9", "所要時間×15840"], // FC2-3
    13: ["火晶×238", "製錬火晶×0", "生肉×79", "木材×79", "石炭×15", "鉄鉱×3.9", "所要時間×15840"], // FC2-4
    14: ["火晶×238", "製錬火晶×0", "生肉×79", "木材×79", "石炭×15", "鉄鉱×3.9", "所要時間×15840"], // FC3
    15: ["火晶×280", "製錬火晶×0", "生肉×82", "木材×82", "石炭×16", "鉄鉱×4.1", "所要時間×17280"], // FC3-1
    16: ["火晶×280", "製錬火晶×0", "生肉×82", "木材×82", "石炭×16", "鉄鉱×4.1", "所要時間×17280"], // FC3-2
    17: ["火晶×280", "製錬火晶×0", "生肉×82", "木材×82", "石炭×16", "鉄鉱×4.1", "所要時間×17280"], // FC3-3
    18: ["火晶×280", "製錬火晶×0", "生肉×82", "木材×82", "石炭×16", "鉄鉱×4.1", "所要時間×17280"], // FC3-4
    19: ["火晶×280", "製錬火晶×0", "生肉×82", "木材×82", "石炭×16", "鉄鉱×4.1", "所要時間×17280"], // FC4
    20: ["火晶×335", "製錬火晶×0", "生肉×84", "木材×84", "石炭×16", "鉄鉱×4.2", "所要時間×20160"], // FC4-1
    21: ["火晶×335", "製錬火晶×0", "生肉×84", "木材×84", "石炭×16", "鉄鉱×4.2", "所要時間×20160"], // FC4-2
    22: ["火晶×335", "製錬火晶×0", "生肉×84", "木材×84", "石炭×16", "鉄鉱×4.2", "所要時間×20160"], // FC4-3
    23: ["火晶×335", "製錬火晶×0", "生肉×84", "木材×84", "石炭×16", "鉄鉱×4.2", "所要時間×20160"], // FC4-4
    24: ["火晶×335", "製錬火晶×0", "生肉×84", "木材×84", "石炭×16", "鉄鉱×4.2", "所要時間×20160"], // FC5
    25: ["火晶×200", "製錬火晶×10", "生肉×96", "木材×96", "石炭×19", "鉄鉱×4.8", "所要時間×21600"], // FC5-1
    26: ["火晶×200", "製錬火晶×10", "生肉×96", "木材×96", "石炭×19", "鉄鉱×4.8", "所要時間×21600"], // FC5-2
    27: ["火晶×200", "製錬火晶×10", "生肉×96", "木材×96", "石炭×19", "鉄鉱×4.8", "所要時間×21600"], // FC5-3
    28: ["火晶×200", "製錬火晶×10", "生肉×96", "木材×96", "石炭×19", "鉄鉱×4.8", "所要時間×21600"], // FC5-4
    29: ["火晶×100", "製錬火晶×20", "生肉×96", "木材×96", "石炭×19", "鉄鉱×4.8", "所要時間×21600"], // FC6
    30: ["火晶×240", "製錬火晶×15", "生肉×100", "木材×100", "石炭×21", "鉄鉱×5.4", "所要時間×25920"], // FC6-1
    31: ["火晶×240", "製錬火晶×15", "生肉×100", "木材×100", "石炭×21", "鉄鉱×5.4", "所要時間×25920"], // FC6-2
    32: ["火晶×240", "製錬火晶×15", "生肉×100", "木材×100", "石炭×21", "鉄鉱×5.4", "所要時間×25920"], // FC6-3
    33: ["火晶×240", "製錬火晶×15", "生肉×100", "木材×100", "石炭×21", "鉄鉱×5.4", "所要時間×25920"], // FC6-4
    34: ["火晶×120", "製錬火晶×30", "生肉×100", "木材×100", "石炭×21", "鉄鉱×5.4", "所要時間×25920"], // FC7
    35: ["火晶×240", "製錬火晶×20", "生肉×130", "木材×130", "石炭×26", "鉄鉱×6.6", "所要時間×28800"], // FC7-1
    36: ["火晶×240", "製錬火晶×20", "生肉×130", "木材×130", "石炭×26", "鉄鉱×6.6", "所要時間×28800"], // FC7-2
    37: ["火晶×240", "製錬火晶×20", "生肉×130", "木材×130", "石炭×26", "鉄鉱×6.6", "所要時間×28800"], // FC7-3
    38: ["火晶×240", "製錬火晶×20", "生肉×130", "木材×130", "石炭×26", "鉄鉱×6.6", "所要時間×28800"], // FC7-4
    39: ["火晶×120", "製錬火晶×40", "生肉×130", "木材×130", "石炭×26", "鉄鉱×6.6", "所要時間×28800"], // FC8
};

// 大使館の素材一覧
const anembassyMaterial = {
    0: ["火晶×33", "製錬火晶×0", "生肉×13", "木材×13", "石炭×2.7", "鉄鉱×0.67", "所要時間×6652"], // 30-1
    1: ["火晶×33", "製錬火晶×0", "生肉×13", "木材×13", "石炭×2.7", "鉄鉱×0.67", "所要時間×6652"], // 30-2
    2: ["火晶×33", "製錬火晶×0", "生肉×13", "木材×13", "石炭×2.7", "鉄鉱×0.67", "所要時間×6652"], // 30-3
    3: ["火晶×33", "製錬火晶×0", "生肉×13", "木材×13", "石炭×2.7", "鉄鉱×0.67", "所要時間×6652"], // 30-4
    4: ["火晶×33", "製錬火晶×0", "生肉×13", "木材×13", "石炭×2.7", "鉄鉱×0.67", "所要時間×6652"], // FC1
    5: ["火晶×39", "製錬火晶×0", "生肉×14", "木材×14", "石炭×2.9", "鉄鉱×0.72", "所要時間×8553"], // FC1-1
    6: ["火晶×39", "製錬火晶×0", "生肉×14", "木材×14", "石炭×2.9", "鉄鉱×0.72", "所要時間×8553"], // FC1-2
    7: ["火晶×39", "製錬火晶×0", "生肉×14", "木材×14", "石炭×2.9", "鉄鉱×0.72", "所要時間×8553"], // FC1-3
    8: ["火晶×39", "製錬火晶×0", "生肉×14", "木材×14", "石炭×2.9", "鉄鉱×0.72", "所要時間×8553"], // FC1-4
    9: ["火晶×39", "製錬火晶×0", "生肉×14", "木材×14", "石炭×2.9", "鉄鉱×0.72", "所要時間×8553"], // FC2
    10: ["火晶×59", "製錬火晶×0", "生肉×15", "木材×15", "石炭×3.1", "鉄鉱×0.79", "所要時間×10454"], // FC2-1
    11: ["火晶×59", "製錬火晶×0", "生肉×15", "木材×15", "石炭×3.1", "鉄鉱×0.79", "所要時間×10454"], // FC2-2
    12: ["火晶×59", "製錬火晶×0", "生肉×15", "木材×15", "石炭×3.1", "鉄鉱×0.79", "所要時間×10454"], // FC2-3
    13: ["火晶×59", "製錬火晶×0", "生肉×15", "木材×15", "石炭×3.1", "鉄鉱×0.79", "所要時間×10454"], // FC2-4
    14: ["火晶×59", "製錬火晶×0", "生肉×15", "木材×15", "石炭×3.1", "鉄鉱×0.79", "所要時間×10454"], // FC3
    15: ["火晶×70", "製錬火晶×0", "生肉×16", "木材×16", "石炭×3.2", "鉄鉱×0.82", "所要時間×11404"], // FC3-1
    16: ["火晶×70", "製錬火晶×0", "生肉×16", "木材×16", "石炭×3.2", "鉄鉱×0.82", "所要時間×11404"], // FC3-2
    17: ["火晶×70", "製錬火晶×0", "生肉×16", "木材×16", "石炭×3.2", "鉄鉱×0.82", "所要時間×11404"], // FC3-3
    18: ["火晶×70", "製錬火晶×0", "生肉×16", "木材×16", "石炭×3.2", "鉄鉱×0.82", "所要時間×11404"], // FC3-4
    19: ["火晶×70", "製錬火晶×0", "生肉×16", "木材×16", "石炭×3.2", "鉄鉱×0.82", "所要時間×11404"], // FC4
    20: ["火晶×83", "製錬火晶×0", "生肉×16", "木材×16", "石炭×3.3", "鉄鉱×0.84", "所要時間×13305"], // FC4-1
    21: ["火晶×83", "製錬火晶×0", "生肉×16", "木材×16", "石炭×3.3", "鉄鉱×0.84", "所要時間×13305"], // FC4-2
    22: ["火晶×83", "製錬火晶×0", "生肉×16", "木材×16", "石炭×3.3", "鉄鉱×0.84", "所要時間×13305"], // FC4-3
    23: ["火晶×83", "製錬火晶×0", "生肉×16", "木材×16", "石炭×3.3", "鉄鉱×0.84", "所要時間×13305"], // FC4-4
    24: ["火晶×83", "製錬火晶×0", "生肉×16", "木材×16", "石炭×3.3", "鉄鉱×0.84", "所要時間×13305"], // FC5
    25: ["火晶×50", "製錬火晶×2", "生肉×19", "木材×19", "石炭×3.8", "鉄鉱×0.96", "所要時間×14256"], // FC5-1
    26: ["火晶×50", "製錬火晶×2", "生肉×19", "木材×19", "石炭×3.8", "鉄鉱×0.96", "所要時間×14256"], // FC5-2
    27: ["火晶×50", "製錬火晶×2", "生肉×19", "木材×19", "石炭×3.8", "鉄鉱×0.96", "所要時間×14256"], // FC5-3
    28: ["火晶×50", "製錬火晶×2", "生肉×19", "木材×19", "石炭×3.8", "鉄鉱×0.96", "所要時間×14256"], // FC5-4
    29: ["火晶×25", "製錬火晶×5", "生肉×19", "木材×19", "石炭×3.8", "鉄鉱×0.96", "所要時間×14256"], // FC6
    30: ["火晶×60", "製錬火晶×3", "生肉×21", "木材×21", "石炭×4.3", "鉄鉱×1", "所要時間×17107"], // FC6-1
    31: ["火晶×60", "製錬火晶×3", "生肉×21", "木材×21", "石炭×4.3", "鉄鉱×1", "所要時間×17107"], // FC6-2
    32: ["火晶×60", "製錬火晶×3", "生肉×21", "木材×21", "石炭×4.3", "鉄鉱×1", "所要時間×17107"], // FC6-3
    33: ["火晶×60", "製錬火晶×3", "生肉×21", "木材×21", "石炭×4.3", "鉄鉱×1", "所要時間×17107"], // FC6-4
    34: ["火晶×30", "製錬火晶×7", "生肉×21", "木材×21", "石炭×4.3", "鉄鉱×1", "所要時間×17107"], // FC7
    35: ["火晶×60", "製錬火晶×5", "生肉×26", "木材×26", "石炭×5.3", "鉄鉱×1.3", "所要時間×19008"], // FC7-1
    36: ["火晶×60", "製錬火晶×5", "生肉×26", "木材×26", "石炭×5.3", "鉄鉱×1.3", "所要時間×19008"], // FC7-2
    37: ["火晶×60", "製錬火晶×5", "生肉×26", "木材×26", "石炭×5.3", "鉄鉱×1.3", "所要時間×19008"], // FC7-3
    38: ["火晶×60", "製錬火晶×5", "生肉×26", "木材×26", "石炭×5.3", "鉄鉱×1.3", "所要時間×19008"], // FC7-4
    39: ["火晶×30", "製錬火晶×11", "生肉×26", "木材×26", "石炭×5.3", "鉄鉱×1.3", "所要時間×19008"], // FC8
};

// 兵舎の素材一覧
const barracksMaterial = {
    0: ["火晶×59", "製錬火晶×0", "生肉×23", "木材×23", "石炭×4.7", "鉄鉱×1.1", "所要時間×1512"], // 30-1
    1: ["火晶×59", "製錬火晶×0", "生肉×23", "木材×23", "石炭×4.7", "鉄鉱×1.1", "所要時間×1512"], // 30-2
    2: ["火晶×59", "製錬火晶×0", "生肉×23", "木材×23", "石炭×4.7", "鉄鉱×1.1", "所要時間×1512"], // 30-3
    3: ["火晶×59", "製錬火晶×0", "生肉×23", "木材×23", "石炭×4.7", "鉄鉱×1.1", "所要時間×1512"], // 30-4
    4: ["火晶×59", "製錬火晶×0", "生肉×23", "木材×23", "石炭×4.7", "鉄鉱×1.1", "所要時間×1512"], // FC1
    5: ["火晶×71", "製錬火晶×0", "生肉×25", "木材×25", "石炭×5", "鉄鉱×1.2", "所要時間×1944"], // FC1-1
    6: ["火晶×71", "製錬火晶×0", "生肉×25", "木材×25", "石炭×5", "鉄鉱×1.2", "所要時間×1944"], // FC1-2
    7: ["火晶×71", "製錬火晶×0", "生肉×25", "木材×25", "石炭×5", "鉄鉱×1.2", "所要時間×1944"], // FC1-3
    8: ["火晶×71", "製錬火晶×0", "生肉×25", "木材×25", "石炭×5", "鉄鉱×1.2", "所要時間×1944"], // FC1-4
    9: ["火晶×71", "製錬火晶×0", "生肉×25", "木材×25", "石炭×5", "鉄鉱×1.2", "所要時間×1944"], // FC2
    10: ["火晶×107", "製錬火晶×0", "生肉×27", "木材×27", "石炭×5.5", "鉄鉱×1.3", "所要時間×2376"], // FC2-1
    11: ["火晶×107", "製錬火晶×0", "生肉×27", "木材×27", "石炭×5.5", "鉄鉱×1.3", "所要時間×2376"], // FC2-2
    12: ["火晶×107", "製錬火晶×0", "生肉×27", "木材×27", "石炭×5.5", "鉄鉱×1.3", "所要時間×2376"], // FC2-3
    13: ["火晶×107", "製錬火晶×0", "生肉×27", "木材×27", "石炭×5.5", "鉄鉱×1.3", "所要時間×2376"], // FC2-4
    14: ["火晶×107", "製錬火晶×0", "生肉×27", "木材×27", "石炭×5.5", "鉄鉱×1.3", "所要時間×2376"], // FC3
    15: ["火晶×126", "製錬火晶×0", "生肉×28", "木材×28", "石炭×5.7", "鉄鉱×1.4", "所要時間×2592"], // FC3-1
    16: ["火晶×126", "製錬火晶×0", "生肉×28", "木材×28", "石炭×5.7", "鉄鉱×1.4", "所要時間×2592"], // FC3-2
    17: ["火晶×126", "製錬火晶×0", "生肉×28", "木材×28", "石炭×5.7", "鉄鉱×1.4", "所要時間×2592"], // FC3-3
    18: ["火晶×126", "製錬火晶×0", "生肉×28", "木材×28", "石炭×5.7", "鉄鉱×1.4", "所要時間×2592"], // FC3-4
    19: ["火晶×126", "製錬火晶×0", "生肉×28", "木材×28", "石炭×5.7", "鉄鉱×1.4", "所要時間×2592"], // FC4
    20: ["火晶×150", "製錬火晶×0", "生肉×29", "木材×29", "石炭×5.9", "鉄鉱×1.4", "所要時間×3024"], // FC4-1
    21: ["火晶×150", "製錬火晶×0", "生肉×29", "木材×29", "石炭×5.9", "鉄鉱×1.4", "所要時間×3024"], // FC4-2
    22: ["火晶×150", "製錬火晶×0", "生肉×29", "木材×29", "石炭×5.9", "鉄鉱×1.4", "所要時間×3024"], // FC4-3
    23: ["火晶×150", "製錬火晶×0", "生肉×29", "木材×29", "石炭×5.9", "鉄鉱×1.4", "所要時間×3024"], // FC4-4
    24: ["火晶×150", "製錬火晶×0", "生肉×29", "木材×29", "石炭×5.9", "鉄鉱×1.4", "所要時間×3024"], // FC5
    25: ["火晶×90", "製錬火晶×4", "生肉×33", "木材×33", "石炭×6.7", "鉄鉱×1.6", "所要時間×3240"], // FC5-1
    26: ["火晶×90", "製錬火晶×4", "生肉×33", "木材×33", "石炭×6.7", "鉄鉱×1.6", "所要時間×3240"], // FC5-2
    27: ["火晶×90", "製錬火晶×4", "生肉×33", "木材×33", "石炭×6.7", "鉄鉱×1.6", "所要時間×3240"], // FC5-3
    28: ["火晶×90", "製錬火晶×4", "生肉×33", "木材×33", "石炭×6.7", "鉄鉱×1.6", "所要時間×3240"], // FC5-4
    29: ["火晶×45", "製錬火晶×9", "生肉×33", "木材×33", "石炭×6.7", "鉄鉱×1.6", "所要時間×3240"], // FC6
    30: ["火晶×108", "製錬火晶×6", "生肉×38", "木材×38", "石炭×7.6", "鉄鉱×1.9", "所要時間×3888"], // FC6-1
    31: ["火晶×108", "製錬火晶×6", "生肉×38", "木材×38", "石炭×7.6", "鉄鉱×1.9", "所要時間×3888"], // FC6-2
    32: ["火晶×108", "製錬火晶×6", "生肉×38", "木材×38", "石炭×7.6", "鉄鉱×1.9", "所要時間×3888"], // FC6-3
    33: ["火晶×108", "製錬火晶×6", "生肉×38", "木材×38", "石炭×7.6", "鉄鉱×1.9", "所要時間×3888"], // FC6-4
    34: ["火晶×54", "製錬火晶×9", "生肉×38", "木材×38", "石炭×7.6", "鉄鉱×1.9", "所要時間×3888"], // FC7
    35: ["火晶×108", "製錬火晶×9", "生肉×46", "木材×46", "石炭×9.3", "鉄鉱×2.3", "所要時間×4320"], // FC7-1
    36: ["火晶×108", "製錬火晶×9", "生肉×46", "木材×46", "石炭×9.3", "鉄鉱×2.3", "所要時間×4320"], // FC7-2
    37: ["火晶×108", "製錬火晶×9", "生肉×46", "木材×46", "石炭×9.3", "鉄鉱×2.3", "所要時間×4320"], // FC7-3
    38: ["火晶×108", "製錬火晶×9", "生肉×46", "木材×46", "石炭×9.3", "鉄鉱×2.3", "所要時間×4320"], // FC7-4
    39: ["火晶×54", "製錬火晶×19", "生肉×46", "木材×46", "石炭×9.3", "鉄鉱×2.3", "所要時間×4320"], // FC8
}

// 司令部の素材一覧
const commandMaterial = {
    0: ["火晶×26", "製錬火晶×0", "生肉×20", "木材×20", "石炭×4", "鉄鉱×1", "所要時間×1209.5"], // 30-1
    1: ["火晶×26", "製錬火晶×0", "生肉×20", "木材×20", "石炭×4", "鉄鉱×1", "所要時間×1209.5"], // 30-2
    2: ["火晶×26", "製錬火晶×0", "生肉×20", "木材×20", "石炭×4", "鉄鉱×1", "所要時間×1209.5"], // 30-3
    3: ["火晶×26", "製錬火晶×0", "生肉×20", "木材×20", "石炭×4", "鉄鉱×1", "所要時間×1209.5"], // 30-4
    4: ["火晶×26", "製錬火晶×0", "生肉×20", "木材×20", "石炭×4", "鉄鉱×1", "所要時間×1209.5"], // FC1
    5: ["火晶×31", "製錬火晶×0", "生肉×21", "木材×21", "石炭×4.3", "鉄鉱×1", "所要時間×1555"], // FC1-1
    6: ["火晶×31", "製錬火晶×0", "生肉×21", "木材×21", "石炭×4.3", "鉄鉱×1", "所要時間×1555"], // FC1-2
    7: ["火晶×31", "製錬火晶×0", "生肉×21", "木材×21", "石炭×4.3", "鉄鉱×1", "所要時間×1555"], // FC1-3
    8: ["火晶×31", "製錬火晶×0", "生肉×21", "木材×21", "石炭×4.3", "鉄鉱×1", "所要時間×1555"], // FC1-4
    9: ["火晶×31", "製錬火晶×0", "生肉×21", "木材×21", "石炭×4.3", "鉄鉱×1", "所要時間×1555"], // FC2
    10: ["火晶×47", "製錬火晶×0", "生肉×23", "木材×23", "石炭×4.7", "鉄鉱×1.1", "所要時間×1900"], // FC2-1
    11: ["火晶×47", "製錬火晶×0", "生肉×23", "木材×23", "石炭×4.7", "鉄鉱×1.1", "所要時間×1900"], // FC2-2
    12: ["火晶×47", "製錬火晶×0", "生肉×23", "木材×23", "石炭×4.7", "鉄鉱×1.1", "所要時間×1900"], // FC2-3
    13: ["火晶×47", "製錬火晶×0", "生肉×23", "木材×23", "石炭×4.7", "鉄鉱×1.1", "所要時間×1900"], // FC2-4
    14: ["火晶×47", "製錬火晶×0", "生肉×23", "木材×23", "石炭×4.7", "鉄鉱×1.1", "所要時間×1900"], // FC3
    15: ["火晶×56", "製錬火晶×0", "生肉×24", "木材×24", "石炭×4.9", "鉄鉱×1.2", "所要時間×2073"], // FC3-1
    16: ["火晶×56", "製錬火晶×0", "生肉×24", "木材×24", "石炭×4.9", "鉄鉱×1.2", "所要時間×2073"], // FC3-2
    17: ["火晶×56", "製錬火晶×0", "生肉×24", "木材×24", "石炭×4.9", "鉄鉱×1.2", "所要時間×2073"], // FC3-3
    18: ["火晶×56", "製錬火晶×0", "生肉×24", "木材×24", "石炭×4.9", "鉄鉱×1.2", "所要時間×2073"], // FC3-4
    19: ["火晶×56", "製錬火晶×0", "生肉×24", "木材×24", "石炭×4.9", "鉄鉱×1.2", "所要時間×2073"], // FC4
    20: ["火晶×67", "製錬火晶×0", "生肉×25", "木材×25", "石炭×5", "鉄鉱×1.2", "所要時間×2431"], // FC4-1
    21: ["火晶×67", "製錬火晶×0", "生肉×25", "木材×25", "石炭×5", "鉄鉱×1.2", "所要時間×2431"], // FC4-2
    22: ["火晶×67", "製錬火晶×0", "生肉×25", "木材×25", "石炭×5", "鉄鉱×1.2", "所要時間×2431"], // FC4-3
    23: ["火晶×67", "製錬火晶×0", "生肉×25", "木材×25", "石炭×5", "鉄鉱×1.2", "所要時間×2431"], // FC4-4
    24: ["火晶×67", "製錬火晶×0", "生肉×25", "木材×25", "石炭×5", "鉄鉱×1.2", "所要時間×2431"], // FC5
    25: ["火晶×40", "製錬火晶×2", "生肉×29", "木材×29", "石炭×5.8", "鉄鉱×1.4", "所要時間×2592"], // FC5-1
    26: ["火晶×40", "製錬火晶×2", "生肉×29", "木材×29", "石炭×5.8", "鉄鉱×1.4", "所要時間×2592"], // FC5-2
    27: ["火晶×40", "製錬火晶×2", "生肉×29", "木材×29", "石炭×5.8", "鉄鉱×1.4", "所要時間×2592"], // FC5-3
    28: ["火晶×40", "製錬火晶×2", "生肉×29", "木材×29", "石炭×5.8", "鉄鉱×1.4", "所要時間×2592"], // FC5-4
    29: ["火晶×20", "製錬火晶×4", "生肉×29", "木材×29", "石炭×5.8", "鉄鉱×1.4", "所要時間×2592"], // FC6
    30: ["火晶×48", "製錬火晶×3", "生肉×32", "木材×32", "石炭×6.5", "鉄鉱×1.5", "所要時間×2970"], // FC6-1
    31: ["火晶×48", "製錬火晶×3", "生肉×32", "木材×32", "石炭×6.5", "鉄鉱×1.5", "所要時間×2970"], // FC6-2
    32: ["火晶×48", "製錬火晶×3", "生肉×32", "木材×32", "石炭×6.5", "鉄鉱×1.5", "所要時間×2970"], // FC6-3
    33: ["火晶×48", "製錬火晶×3", "生肉×32", "木材×32", "石炭×6.5", "鉄鉱×1.5", "所要時間×2970"], // FC6-4
    34: ["火晶×24", "製錬火晶×6", "生肉×32", "木材×32", "石炭×6.5", "鉄鉱×1.5", "所要時間×2970"], // FC7
    35: ["火晶×48", "製錬火晶×4", "生肉×39", "木材×39", "石炭×7.9", "鉄鉱×1.9", "所要時間×3456"], // FC7-1
    36: ["火晶×48", "製錬火晶×4", "生肉×39", "木材×39", "石炭×7.9", "鉄鉱×1.9", "所要時間×3456"], // FC7-2
    37: ["火晶×48", "製錬火晶×4", "生肉×39", "木材×39", "石炭×7.9", "鉄鉱×1.9", "所要時間×3456"], // FC7-3
    38: ["火晶×48", "製錬火晶×4", "生肉×39", "木材×39", "石炭×7.9", "鉄鉱×1.9", "所要時間×3456"], // FC7-4
    39: ["火晶×24", "製錬火晶×8", "生肉×39", "木材×39", "石炭×7.9", "鉄鉱×1.9", "所要時間×3456"], // FC8
}

// 軍医所の素材一覧
const militaryMaterial = {
    0: ["火晶×26", "製錬火晶×0", "生肉×16", "木材×16", "石炭×3.3", "鉄鉱×0.84", "所要時間×1411"], // 30-1
    1: ["火晶×26", "製錬火晶×0", "生肉×16", "木材×16", "石炭×3.3", "鉄鉱×0.84", "所要時間×1411"], // 30-2
    2: ["火晶×26", "製錬火晶×0", "生肉×16", "木材×16", "石炭×3.3", "鉄鉱×0.84", "所要時間×1411"], // 30-3
    3: ["火晶×26", "製錬火晶×0", "生肉×16", "木材×16", "石炭×3.3", "鉄鉱×0.84", "所要時間×1411"], // 30-4
    4: ["火晶×26", "製錬火晶×0", "生肉×16", "木材×16", "石炭×3.3", "鉄鉱×0.84", "所要時間×1411"], // FC1
    5: ["火晶×31", "製錬火晶×0", "生肉×18", "木材×18", "石炭×3.6", "鉄鉱×0.9", "所要時間×1814"], // FC1-1
    6: ["火晶×31", "製錬火晶×0", "生肉×18", "木材×18", "石炭×3.6", "鉄鉱×0.9", "所要時間×1814"], // FC1-2
    7: ["火晶×31", "製錬火晶×0", "生肉×18", "木材×18", "石炭×3.6", "鉄鉱×0.9", "所要時間×1814"], // FC1-3
    8: ["火晶×31", "製錬火晶×0", "生肉×18", "木材×18", "石炭×3.6", "鉄鉱×0.9", "所要時間×1814"], // FC1-4
    9: ["火晶×31", "製錬火晶×0", "生肉×18", "木材×18", "石炭×3.6", "鉄鉱×0.9", "所要時間×1814"], // FC2
    10: ["火晶×47", "製錬火晶×0", "生肉×19", "木材×19", "石炭×3.9", "鉄鉱×0.99", "所要時間×2217"], // FC2-1
    11: ["火晶×47", "製錬火晶×0", "生肉×19", "木材×19", "石炭×3.9", "鉄鉱×0.99", "所要時間×2217"], // FC2-2
    12: ["火晶×47", "製錬火晶×0", "生肉×19", "木材×19", "石炭×3.9", "鉄鉱×0.99", "所要時間×2217"], // FC2-3
    13: ["火晶×47", "製錬火晶×0", "生肉×19", "木材×19", "石炭×3.9", "鉄鉱×0.99", "所要時間×2217"], // FC2-4
    14: ["火晶×47", "製錬火晶×0", "生肉×19", "木材×19", "石炭×3.9", "鉄鉱×0.99", "所要時間×2217"], // FC3
    15: ["火晶×56", "製錬火晶×0", "生肉×20", "木材×20", "石炭×4.1", "鉄鉱×1", "所要時間×2419"], // FC3-1
    16: ["火晶×56", "製錬火晶×0", "生肉×20", "木材×20", "石炭×4.1", "鉄鉱×1", "所要時間×2419"], // FC3-2
    17: ["火晶×56", "製錬火晶×0", "生肉×20", "木材×20", "石炭×4.1", "鉄鉱×1", "所要時間×2419"], // FC3-3
    18: ["火晶×56", "製錬火晶×0", "生肉×20", "木材×20", "石炭×4.1", "鉄鉱×1", "所要時間×2419"], // FC3-4
    19: ["火晶×56", "製錬火晶×0", "生肉×20", "木材×20", "石炭×4.1", "鉄鉱×1", "所要時間×2419"], // FC4
    20: ["火晶×67", "製錬火晶×0", "生肉×21", "木材×21", "石炭×4.2", "鉄鉱×1", "所要時間×2822"], // FC4-1
    21: ["火晶×67", "製錬火晶×0", "生肉×21", "木材×21", "石炭×4.2", "鉄鉱×1", "所要時間×2822"], // FC4-2
    22: ["火晶×67", "製錬火晶×0", "生肉×21", "木材×21", "石炭×4.2", "鉄鉱×1", "所要時間×2822"], // FC4-3
    23: ["火晶×67", "製錬火晶×0", "生肉×21", "木材×21", "石炭×4.2", "鉄鉱×1", "所要時間×2822"], // FC4-4
    24: ["火晶×67", "製錬火晶×0", "生肉×21", "木材×21", "石炭×4.2", "鉄鉱×1", "所要時間×2822"], // FC5
    25: ["火晶×40", "製錬火晶×2", "生肉×24", "木材×24", "石炭×4.8", "鉄鉱×1.2", "所要時間×3024"], // FC5-1
    26: ["火晶×40", "製錬火晶×2", "生肉×24", "木材×24", "石炭×4.8", "鉄鉱×1.2", "所要時間×3024"], // FC5-2
    27: ["火晶×40", "製錬火晶×2", "生肉×24", "木材×24", "石炭×4.8", "鉄鉱×1.2", "所要時間×3024"], // FC5-3
    28: ["火晶×40", "製錬火晶×2", "生肉×24", "木材×24", "石炭×4.8", "鉄鉱×1.2", "所要時間×3024"], // FC5-4
    29: ["火晶×20", "製錬火晶×4", "生肉×24", "木材×24", "石炭×4.8", "鉄鉱×1.2", "所要時間×3024"], // FC6
    30: ["火晶×48", "製錬火晶×3", "生肉×27", "木材×27", "石炭×5.4", "鉄鉱×1.3", "所要時間×3628"], // FC6-1
    31: ["火晶×48", "製錬火晶×3", "生肉×27", "木材×27", "石炭×5.4", "鉄鉱×1.3", "所要時間×3628"], // FC6-2
    32: ["火晶×48", "製錬火晶×3", "生肉×27", "木材×27", "石炭×5.4", "鉄鉱×1.3", "所要時間×3628"], // FC6-3
    33: ["火晶×48", "製錬火晶×3", "生肉×27", "木材×27", "石炭×5.4", "鉄鉱×1.3", "所要時間×3628"], // FC6-4
    34: ["火晶×24", "製錬火晶×6", "生肉×27", "木材×27", "石炭×5.4", "鉄鉱×1.3", "所要時間×3628"], // FC7
    35: ["火晶×48", "製錬火晶×4", "生肉×33", "木材×33", "石炭×6.6", "鉄鉱×1.6", "所要時間×4032"], // FC7-1
    36: ["火晶×48", "製錬火晶×4", "生肉×33", "木材×33", "石炭×6.6", "鉄鉱×1.6", "所要時間×4032"], // FC7-2
    37: ["火晶×48", "製錬火晶×4", "生肉×33", "木材×33", "石炭×6.6", "鉄鉱×1.6", "所要時間×4032"], // FC7-3
    38: ["火晶×48", "製錬火晶×4", "生肉×33", "木材×33", "石炭×6.6", "鉄鉱×1.6", "所要時間×4032"], // FC7-4
    39: ["火晶×24", "製錬火晶×8", "生肉×33", "木材×33", "石炭×6.6", "鉄鉱×1.6", "所要時間×4032"], // FC8
}

// 戦争学園の素材一覧
const academyMaterial = {
    0: ["火晶×0", "製錬火晶×0", "生肉×0", "木材×0", "石炭×0", "鉄鉱×0", "所要時間×0"], // 30-1
    1: ["火晶×0", "製錬火晶×0", "生肉×0", "木材×0", "石炭×0", "鉄鉱×0", "所要時間×0"], // 30-2
    2: ["火晶×0", "製錬火晶×0", "生肉×0", "木材×0", "石炭×0", "鉄鉱×0", "所要時間×0"], // 30-3
    3: ["火晶×0", "製錬火晶×0", "生肉×0", "木材×0", "石炭×0", "鉄鉱×0", "所要時間×0"], // 30-4
    4: ["火晶×0", "製錬火晶×0", "生肉×0", "木材×0", "石炭×0", "鉄鉱×0", "所要時間×0.03"], // FC1
    5: ["火晶×71", "製錬火晶×0", "生肉×36", "木材×36", "石炭×7.2", "鉄鉱×1.8", "所要時間×2592"], // FC1-1
    6: ["火晶×71", "製錬火晶×0", "生肉×36", "木材×36", "石炭×7.2", "鉄鉱×1.8", "所要時間×2592"], // FC1-2
    7: ["火晶×71", "製錬火晶×0", "生肉×36", "木材×36", "石炭×7.2", "鉄鉱×1.8", "所要時間×2592"], // FC1-3
    8: ["火晶×71", "製錬火晶×0", "生肉×36", "木材×36", "石炭×7.2", "鉄鉱×1.8", "所要時間×2592"], // FC1-4
    9: ["火晶×71", "製錬火晶×0", "生肉×36", "木材×36", "石炭×7.2", "鉄鉱×1.8", "所要時間×2592"], // FC2
    10: ["火晶×107", "製錬火晶×0", "生肉×39", "木材×39", "石炭×7.9", "鉄鉱×1.9", "所要時間×3168"], // FC2-1
    11: ["火晶×107", "製錬火晶×0", "生肉×39", "木材×39", "石炭×7.9", "鉄鉱×1.9", "所要時間×3168"], // FC2-2
    12: ["火晶×107", "製錬火晶×0", "生肉×39", "木材×39", "石炭×7.9", "鉄鉱×1.9", "所要時間×3168"], // FC2-3
    13: ["火晶×107", "製錬火晶×0", "生肉×39", "木材×39", "石炭×7.9", "鉄鉱×1.9", "所要時間×3168"], // FC2-4
    14: ["火晶×107", "製錬火晶×0", "生肉×39", "木材×39", "石炭×7.9", "鉄鉱×1.9", "所要時間×3168"], // FC3
    15: ["火晶×126", "製錬火晶×0", "生肉×41", "木材×41", "石炭×8.2", "鉄鉱×2", "所要時間×3456"], // FC3-1
    16: ["火晶×126", "製錬火晶×0", "生肉×41", "木材×41", "石炭×8.2", "鉄鉱×2", "所要時間×3456"], // FC3-2
    17: ["火晶×126", "製錬火晶×0", "生肉×41", "木材×41", "石炭×8.2", "鉄鉱×2", "所要時間×3456"], // FC3-3
    18: ["火晶×126", "製錬火晶×0", "生肉×41", "木材×41", "石炭×8.2", "鉄鉱×2", "所要時間×3456"], // FC3-4
    19: ["火晶×126", "製錬火晶×0", "生肉×41", "木材×41", "石炭×8.2", "鉄鉱×2", "所要時間×3456"], // FC4
    20: ["火晶×150", "製錬火晶×0", "生肉×42", "木材×42", "石炭×8.2", "鉄鉱×2.1", "所要時間×4032"], // FC4-1
    21: ["火晶×150", "製錬火晶×0", "生肉×42", "木材×42", "石炭×8.2", "鉄鉱×2.1", "所要時間×4032"], // FC4-2
    22: ["火晶×150", "製錬火晶×0", "生肉×42", "木材×42", "石炭×8.2", "鉄鉱×2.1", "所要時間×4032"], // FC4-3
    23: ["火晶×150", "製錬火晶×0", "生肉×42", "木材×42", "石炭×8.2", "鉄鉱×2.1", "所要時間×4032"], // FC4-4
    24: ["火晶×150", "製錬火晶×0", "生肉×42", "木材×42", "石炭×8.2", "鉄鉱×2.1", "所要時間×4032"], // FC5
    25: ["火晶×90", "製錬火晶×4", "生肉×48", "木材×48", "石炭×9.6", "鉄鉱×2.4", "所要時間×4320"], // FC5-1
    26: ["火晶×90", "製錬火晶×4", "生肉×48", "木材×48", "石炭×9.6", "鉄鉱×2.4", "所要時間×4320"], // FC5-2
    27: ["火晶×90", "製錬火晶×4", "生肉×48", "木材×48", "石炭×9.6", "鉄鉱×2.4", "所要時間×4320"], // FC5-3
    28: ["火晶×90", "製錬火晶×4", "生肉×48", "木材×48", "石炭×9.6", "鉄鉱×2.4", "所要時間×4320"], // FC5-4
    29: ["火晶×45", "製錬火晶×9", "生肉×48", "木材×48", "石炭×9.6", "鉄鉱×2.4", "所要時間×4320"], // FC6
    30: ["火晶×108", "製錬火晶×6", "生肉×54", "木材×54", "石炭×10", "鉄鉱×2.7", "所要時間×5184"], // FC6-1
    31: ["火晶×108", "製錬火晶×6", "生肉×54", "木材×54", "石炭×10", "鉄鉱×2.7", "所要時間×5184"], // FC6-2
    32: ["火晶×108", "製錬火晶×6", "生肉×54", "木材×54", "石炭×10", "鉄鉱×2.7", "所要時間×5184"], // FC6-3
    33: ["火晶×108", "製錬火晶×6", "生肉×54", "木材×54", "石炭×10", "鉄鉱×2.7", "所要時間×5184"], // FC6-4
    34: ["火晶×54", "製錬火晶×13", "生肉×54", "木材×54", "石炭×10", "鉄鉱×2.7", "所要時間×5184"], // FC7
    35: ["火晶×108", "製錬火晶×9", "生肉×66", "木材×66", "石炭×13", "鉄鉱×3.3", "所要時間×5760"], // FC7-1
    36: ["火晶×108", "製錬火晶×9", "生肉×66", "木材×66", "石炭×13", "鉄鉱×3.3", "所要時間×5760"], // FC7-2
    37: ["火晶×108", "製錬火晶×9", "生肉×66", "木材×66", "石炭×13", "鉄鉱×3.3", "所要時間×5760"], // FC7-3
    38: ["火晶×108", "製錬火晶×9", "生肉×66", "木材×66", "石炭×13", "鉄鉱×3.3", "所要時間×5760"], // FC7-4
    39: ["火晶×108", "製錬火晶×9", "生肉×66", "木材×66", "石炭×13", "鉄鉱×3.3", "所要時間×5760"], // FC8
}

const template = {
    0: ["火晶×", "製錬火晶×0", "生肉×", "木材×", "石炭×", "鉄鉱×", "所要時間×"], // 30-1 ~ FC1
    0: ["火晶×", "製錬火晶×0", "生肉×", "木材×", "石炭×", "鉄鉱×", "所要時間×"], // FC1-1 ~ FC2
    10: ["火晶×", "製錬火晶×0", "生肉×", "木材×", "石炭×", "鉄鉱×", "所要時間×"], // FC2-1 ~ FC3
    10: ["火晶×", "製錬火晶×0", "生肉×", "木材×", "石炭×", "鉄鉱×", "所要時間×"], // FC3-1 ~ FC4
    20: ["火晶×", "製錬火晶×0", "生肉×", "木材×", "石炭×", "鉄鉱×", "所要時間×"], // FC4-1 ~ FC5
    20: ["火晶×", "製錬火晶×0", "生肉×", "木材×", "石炭×", "鉄鉱×", "所要時間×"], // FC5-1 ~ FC5-4
    30: ["火晶×", "製錬火晶×0", "生肉×", "木材×", "石炭×", "鉄鉱×", "所要時間×"], // FC6
    30: ["火晶×", "製錬火晶×0", "生肉×", "木材×", "石炭×", "鉄鉱×", "所要時間×"], // FC6-1 ~ FC6-4
    30: ["火晶×", "製錬火晶×0", "生肉×", "木材×", "石炭×", "鉄鉱×", "所要時間×"], // FC7
    30: ["火晶×", "製錬火晶×0", "生肉×", "木材×", "石炭×", "鉄鉱×", "所要時間×"], // FC7-1 ~ FC7-4
    30: ["火晶×", "製錬火晶×0", "生肉×", "木材×", "石炭×", "鉄鉱×", "所要時間×"], // FC8
}

// 入力欄を生成
for (let i = 0; i < setNames.length; i++) {
    const div = document.createElement("div");
    div.innerHTML = `
    <strong>${setNames[i]}</strong><br>
    <label>現在のレベル：
      <select id="start${i}">
        ${fireLevels.slice(0, 42).map((label, idx) => `<option value="${idx}">${label}</option>`).join('')}
      </select>
    </label><br>
    <label>　希望レベル：
      <select id="end${i}">
        ${fireLevels.slice(0, 42).map((label, idx) => `<option value="${idx}">${label}</option>`).join('')}
      </select>
    </label>
    
    <hr>
  `;
    rankGroups.appendChild(div);

    document.getElementById(`start${i}`).addEventListener("change", updateTable);
    document.getElementById(`end${i}`).addEventListener("change", updateTable);
}

// 表描画
function updateTable() {
    const totalsPerSet = Array(setNames.length).fill(null).map(() => {
        return { "火晶": 0, "製錬火晶": 0, "生肉": 0, "木材": 0, "石炭": 0, "鉄鉱": 0, "所要時間": 0 };
    });
    const totalAll = { "火晶": 0, "製錬火晶": 0, "生肉": 0, "木材": 0, "石炭": 0, "鉄鉱": 0, "所要時間": 0 };

    for (let i = 0; i < setNames.length; i++) {
        const start = parseInt(document.getElementById(`start${i}`).value);
        const end = parseInt(document.getElementById(`end${i}`).value);
        const from = start;
        const to = end;
        let currentMaterialTable;
        switch (setNames[i]) {
            case "大溶鉱炉":
                currentMaterialTable = blastMaterial;
                break;
            case "大使館":
                currentMaterialTable = anembassyMaterial;
                break;
            case "盾兵舎":
                currentMaterialTable = barracksMaterial;
                break;
            case "槍兵舎":
                currentMaterialTable = barracksMaterial;
                break;
            case "弓兵舎":
                currentMaterialTable = barracksMaterial;
                break;
            case "司令部":
                currentMaterialTable = commandMaterial;
                break;
            case "軍医所":
                currentMaterialTable = militaryMaterial;
                break;
            case "戦争学園":
                currentMaterialTable = academyMaterial;
                break;
        }

        if (from !== to && from < to) {
            for (let lv = from; lv < to; lv++) {
                if (!currentMaterialTable[lv]) continue;
                currentMaterialTable[lv].forEach(entry => {
                    const [name, val] = entry.split("×");
                    const n = parseInt(val);
                    totalsPerSet[i][name] += n;
                    totalAll[name] += n;
                });
            }
        }
    }

    let html = `<table class="styled-table"><thead><tr><th>セット</th>`;
    materialKeys.forEach(key => {
        html += `<th><img src="${fire_crystal_materialImages[key]}" width="32"><br>${key}</th>`;
    });
    html += `</tr></thead><tbody>`;

    const materialUnits = {
        "火晶": "", "製錬火晶": "", "生肉": " M", "木材": " M", "石炭": " M", "鉄鉱": " M", "所要時間": " 分"
    };

    for (let i = 0; i < setNames.length; i++) {
        html += `<tr><td>${setNames[i]}</td>`;
        materialKeys.forEach(key => {
            html += `<td>${totalsPerSet[i][key]}${materialUnits[key]}</td>`;
        });
        html += `</tr>`;
    }

    html += `<tr><td><strong>合計</strong></td>`;
    materialKeys.forEach(key => {
        html += `<td><strong>${totalAll[key]}${materialUnits[key]}</strong></td>`;
    });
    html += `</tr></tbody></table>`;

    const resultDiv = document.getElementById('result');
    resultDiv.innerHTML = html;

    const saveButton = document.getElementById('saveButton');
    if (totalAll.火晶 > 0 || totalAll.製錬火晶 > 0) {
        saveButton.style.display = 'block';
    } else {
        saveButton.style.display = 'none';
    }
}

document.addEventListener('DOMContentLoaded', function () {
    // URLから復元データを読み込むロジック
    const urlParams = new URLSearchParams(window.location.search);
    const restoreData = urlParams.get('data');

    if (restoreData) {
        try {
            const inputData = JSON.parse(decodeURIComponent(restoreData));
            inputData.forEach(item => {
                const selectElement = document.getElementById(item.id);
                if (selectElement) {
                    selectElement.value = item.value;
                }
            });
            updateTable();
        } catch (e) {
            console.error('復元データの解析に失敗しました:', e);
        }
    } else {
        // 復元データがない場合は初期表示
        updateTable();
    }

    // 保存ボタンのイベントリスナー
    const saveButton = document.getElementById('saveButton');
    const resultDiv = document.getElementById('result');
    const rankGroups = document.getElementById('rankGroups');

    if (saveButton) { // HTML要素が存在することを確認
        saveButton.addEventListener('click', function () {
            const resultTitle = "火晶計算結果";
            const resultHtml = resultDiv.innerHTML;

            const inputData = [];
            const selectElements = rankGroups.querySelectorAll('select');
            selectElements.forEach(select => {
                inputData.push({
                    id: select.id,
                    value: select.value
                });
            });

            fetch('/accounts/save_calculation_result/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken'),
                },
                body: JSON.stringify({
                    title: resultTitle,
                    result_html: resultHtml,
                    input_data: inputData
                })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        alert('計算結果がプロフィールに保存されました！');
                    } else {
                        alert('保存に失敗しました: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('通信エラーが発生しました。');
                });
        });
    }

    // CSRFトークンを取得するヘルパー関数
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.startsWith(name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    // ★クリアボタンのイベントリスナーを追加
    const clearButton = document.getElementById('clearButton');
    if (clearButton) {
        clearButton.addEventListener('click', function () {
            // すべての入力欄をクリア
            const selectElements = document.querySelectorAll('#rankGroups select');
            selectElements.forEach(select => {
                select.value = "0"; // レベルを0にリセット
            });

            // テーブルを再計算して表示を更新
            updateTable();
        });
    }
});